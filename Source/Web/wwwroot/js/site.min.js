var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AddWordPanel=function(n){function t(){var t=n.call(this)||this;return t.state={alert:{type:AlertType.Hidden}},t}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h3",{className:"panel-title"},"Add Words")),React.createElement("div",{className:"panel-body"},React.createElement(Alert,{model:this.state.alert}),React.createElement(WordForm,{onSuccess:this.onWordAddedSuccess.bind(this),onError:this.onWordAddedError.bind(this)})))},t.prototype.onWordAddedSuccess=function(n){this.setState({alert:{type:AlertType.Success,title:"Success",message:"Your word "+n.spelling+" has been added."}});this.props.onWordAdded&&this.props.onWordAdded(n)},t.prototype.onWordAddedError=function(n,t,i){this.setState({alert:{type:AlertType.Danger,title:t,message:i}})},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AdminPage=function(n){function t(){var t=n.call(this)||this;return t.state={words:[]},t}return __extends(t,n),t.prototype.componentDidMount=function(){var n=this;$.get("/api/word",function(t){n.setState({words:t})})},t.prototype.render=function(){return React.createElement("div",null,React.createElement(AddWordPanel,{onWordAdded:this._handleWordAdded.bind(this)}),React.createElement(WordTablePanel,{words:this.state.words}))},t.prototype._handleWordAdded=function(n){var t=[n].concat(this.state.words);this.setState({words:t})},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AlertType,Alert,Colors;(function(n){n[n.Success=0]="Success";n[n.Info=1]="Info";n[n.Warning=2]="Warning";n[n.Danger=3]="Danger";n[n.Hidden=4]="Hidden"})(AlertType||(AlertType={}));Alert=function(n){function t(){return n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){var n="alert alert-"+AlertType[this.props.model.type].toString().toLowerCase();return this.props.model.type==AlertType.Hidden?React.createElement("div",null):React.createElement("div",{className:n,role:"alert"},React.createElement("strong",null,this.props.model.title,":")," ",this.props.model.message)},t}(React.Component);Colors=function(){function n(){}return n.random=function(){return n._colorClasses[Math.floor(Math.random()*n._colorClasses.length)]},n}();Colors._colorClasses=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"];var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},EditWordModal=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.componentWillMount=function(){this.state={saveButtonDisabled:!0,edittingWord:{spelling:this.props.word.spelling,chinese:this.props.word.chinese,usPron:this.props.word.usPron,ukPron:this.props.word.ukPron}}},t.prototype.componentDidMount=function(){$(this.refs.modal).modal()},t.prototype.render=function(){var n="btn btn-primary";return this.state.saveButtonDisabled&&(n+=" disabled"),React.createElement("div",{className:"modal fade edit-word-modal",ref:"modal",role:"dialog","data-backdrop":"static","data-keyboard":"false"},React.createElement("div",{className:"modal-dialog",role:"document"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this._handleClose.bind(this)},React.createElement("span",{"aria-hidden":"true"},"× ")),React.createElement("h4",{className:"modal-title"},"Edit Word")),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"Spelling"),React.createElement("input",{type:"text",value:this.state.edittingWord.spelling,className:"form-control",ref:"spelling",contentEditable:!1,readOnly:!0})),React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"Chinese (optional) "),React.createElement("input",{type:"text",value:this.state.edittingWord.chinese,className:"form-control",ref:"chinese",onChange:this._handleChineseChange.bind(this)})),React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"US Pron."),React.createElement("input",{type:"text",value:this.state.edittingWord.usPron,className:"form-control",ref:"usPron",onChange:this._handleUsPronChange.bind(this)})),React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"UK Pron."),React.createElement("input",{type:"text",value:this.state.edittingWord.ukPron,className:"form-control",ref:"ukPron",onChange:this._handleUkPronChange.bind(this)}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-default pull-left",onClick:this._clear.bind(this)},"Clear"),React.createElement("button",{type:"button",className:"btn btn-default pull-left",onClick:this._sync.bind(this)},"Sync from Bing Dict"),React.createElement("button",{type:"button",className:n,onClick:this._saveWord.bind(this),"data-dismiss":"modal",disabled:this.state.saveButtonDisabled},"Save")))))},t.prototype._handleChineseChange=function(n){this.state.saveButtonDisabled=!1;this.state.edittingWord.chinese=n.currentTarget.value;this.setState(this.state)},t.prototype._handleUsPronChange=function(n){this.state.saveButtonDisabled=!1;this.state.edittingWord.usPron=n.currentTarget.value;this.setState(this.state)},t.prototype._handleUkPronChange=function(n){this.state.saveButtonDisabled=!1;this.state.edittingWord.ukPron=n.currentTarget.value;this.setState(this.state)},t.prototype._handleClose=function(){this.props.onClosed&&this.props.onClosed()},t.prototype._saveWord=function(){var n=this;$.ajax({url:"/api/Word/"+this.state.edittingWord.spelling,method:"PUT",data:this.state.edittingWord,success:function(t){n.props.onSaved&&n.props.onSaved(t)}})},t.prototype._clear=function(){this._updateState("","","",!0)},t.prototype._sync=function(){var n=this;$.get("/api/bing/"+this.props.word.spelling,function(t){n._updateState(t.chinese,t.pron.us,t.pron.uk)})},t.prototype._updateState=function(n,t,i,r){r===void 0&&(r=!1);this.state.saveButtonDisabled=!1;this.state.edittingWord.chinese=r?n:this.state.edittingWord.chinese||n;this.state.edittingWord.usPron=r?t:this.state.edittingWord.usPron||t;this.state.edittingWord.ukPron=r?i:this.state.edittingWord.ukPron||i;this.setState(this.state)},t}(React.Component),HomePage=function(){function n(){var n=this;$(document).ready(function(){n._LoadWords()})}return n.prototype._LoadWords=function(){var n=this;$.get("/api/word/top200",function(t){n._DrawWordCloud(t)})},n.prototype._DrawWordCloud=function(n){var o=new WordCloudFontSize(10,120,n.length),i=$("#home_page").width(),r=$("#home_page").height(),u=Math.round(Math.min(i,r/3*4)),f=Math.round(Math.min(i/4*3,r)),t=$("#word_cloud"),e;t.attr("width",u);t.attr("height",f);e={list:n.map(function(n){return[n.spelling,o.next()]}).sort(function(n,t){return n[1]<t[1]?1:-1}),gridSize:15,origin:[u/2,f/2],fontFamily:"Roboto",clearCanvas:!0,wait:10,shuffle:!0,rotateRatio:.3,shape:"circle",color:function(){return Colors.random()}};WordCloud(t[0],e)},n}(),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},PronDropdown=function(n){function t(){return n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){var n=t._prons.map(function(n){return React.createElement("span",{className:"label label-default"},n)});return React.createElement("div",{className:"dropdown-menu dropdown-menu-right prons-dropdown"},n)},t}(React.Component);PronDropdown._prons=["s","t","r","i","p","ɔ","ɪ","n","ə","d","l","v","e","m","ʌ","j","u","ʒ","b","o","ʊ","a","ŋ","æ","h","f","ð","ʃ","k","ɜ","θ","w","ɑ","ɡ","z","ɒ"," ","u:","ɔ:"];var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},SearchableWordList=function(n){function t(){var t=n.call(this)||this;return t.state={keyword:""},t}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",null,React.createElement(SearchBox,{keyword:"",onUserInput:this.handleUserInput.bind(this)}),React.createElement(WordList,{words:this.props.words,keyword:this.state.keyword}))},t.prototype.handleUserInput=function(n){this.setState({keyword:n})},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},SearchBox=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",{className:"row",id:"search_box"},React.createElement("div",{className:"col-lg-3"}),React.createElement("div",{className:"col-lg-6"},React.createElement("div",{className:"input-group input-group-lg"},React.createElement("input",{type:"text",className:"form-control",id:"search_box_input",ref:"keyword",onChange:this.handleChange.bind(this)}),React.createElement("div",{className:"input-group-btn"},React.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Pron ",React.createElement("span",{className:"caret"})),React.createElement(PronDropdown,null)))),React.createElement("div",{className:"col-lg-3"}))},t.prototype.handleChange=function(){this.props.onUserInput(this.refs.keyword.value)},t}(React.Component),SearchPage=function(){function n(){var n=this;$(document).ready(function(){n._LoadWords()})}return n.prototype._LoadWords=function(){$.get("/api/word",function(n){ReactDOM.render(React.createElement(SearchableWordList,{words:n}),document.getElementById("search_page"))})},n}(),WordCloudFontSize=function(){function n(n,t,i){this._min=n;this._max=t;this._count=i;this._sum=n*i+(t-n)*i/10}return n.prototype.next=function(){var n=this._min,t=this._sum-this._count*this._min;return t>0&&(n=Math.min(Math.random()*t/this._count*5+this._min,this._max)),this._count--,this._sum-=n,n},n}(),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordForm=function(n){function t(){return n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",{id:"add_word"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6 col-lg-6"},React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"Spelling"),React.createElement("input",{type:"text",className:"form-control",placeholder:"English spelling...",ref:"spelling",onKeyPress:this.handleKeyPress.bind(this)}))),React.createElement("div",{className:"col-md-6 col-lg-6"},React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-addon"},"Chinese (optional)"),React.createElement("input",{type:"text",className:"form-control",placeholder:"中文...",ref:"chinese",onKeyPress:this.handleKeyPress.bind(this)})))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12  col-lg-12"},React.createElement("button",{className:"btn btn-primary",type:"button",onClick:this.handleButtonClick.bind(this)},"Add"))))},t.prototype.handleKeyPress=function(n){n.key==="Enter"&&this.handleButtonClick()},t.prototype.handleButtonClick=function(){var n=this,t={spelling:this.refs.spelling.value,chinese:this.refs.chinese.value};t.spelling&&$.ajax({method:"POST",url:"/api/word",data:t,success:function(t){n.props.onSuccess(t);n.refs.spelling.value="";n.refs.spelling.focus();n.refs.chinese.value=""},error:function(i,r,u){n.props.onError(t,u,JSON.parse(i.responseText).message)}})},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordItem=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.render=function(){if(this.props.highlight){var n=this.props.word.spelling.substring(0,this.props.highlight.start),t=this.props.word.spelling.substring(this.props.highlight.start,this.props.highlight.end),i=this.props.word.spelling.substring(this.props.highlight.end);return React.createElement("span",{className:"word"},n,React.createElement("span",{className:"highlight"},t),i)}return React.createElement("span",{className:"word"},this.props.word.spelling)},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordList=function(n){function t(){return n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){var i=this,n=[],t=this.props.keyword;return t?this.props.words.forEach(function(r){var u=r.spelling.indexOf(t),f;u>=0&&(f={start:u,end:u+i.props.keyword.length},n.push(React.createElement(WordItem,{word:r,key:r.spelling,highlight:f})))}):this.props.words.forEach(function(t){n.push(React.createElement(WordItem,{word:t,key:t.spelling}))}),React.createElement("div",{id:"word_list",className:"clearfix"},n)},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordTable=function(n){function t(){return n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){var n=this.props.words.map(function(n){return React.createElement(WordTableRow,{key:n.spelling,word:n})});return React.createElement("table",{id:"word_table"},React.createElement("tbody",null,n))},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordTablePanel=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h3",{className:"panel-title"},"All Words")),React.createElement("div",{className:"panel-body"},React.createElement(WordTable,{words:this.props.words})))},t}(React.Component),__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},WordTableRow=function(n){function t(){var t=n.call(this)||this;return t.state={isEditting:!1},t}return __extends(t,n),t.prototype.render=function(){return this.state.isEditting?React.createElement("tr",null,React.createElement("td",null,this.props.word.spelling),React.createElement("td",null,this.props.word.usPron),React.createElement("td",null,this.props.word.chinese),React.createElement("td",null,React.createElement(EditWordModal,{word:this.props.word,onSaved:this._onEditModalSaved.bind(this),onClosed:this._onEditModalClosed.bind(this)}))):React.createElement("tr",{onClick:this._handleClick.bind(this)},React.createElement("td",null,this.props.word.spelling),React.createElement("td",null,this.props.word.usPron),React.createElement("td",null,this.props.word.chinese),React.createElement("td",null))},t.prototype._handleClick=function(){this.setState({isEditting:!0})},t.prototype._onEditModalSaved=function(n){this.props.word.chinese=n.chinese;this.props.word.usPron=n.usPron;this.props.word.ukPron=n.ukPron;this.setState({isEditting:!1})},t.prototype._onEditModalClosed=function(){this.setState({isEditting:!1})},t}(React.Component);